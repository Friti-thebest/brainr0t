-- Cabeçalho e serviços
local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local uis = game:GetService("UserInputService")
local ts = game:GetService("TeleportService")
local http = game:GetService("HttpService")
local runService = game:GetService("RunService")

-- Variáveis
local running = true
local minimized = false
local noclipEnabled = false
local superJumpEnabled = false
local espEnabled = false
local roubarEnabled = false
local roubarPlataforma = nil
local voandoRoubo = false
local espParts = {}
local goEnabled = false
local shiftlockEnabled = false

-- Detecta se é dispositivo móvel
local isMobile = game:GetService("UserInputService").TouchEnabled

-- Define o tamanho da interface baseado no dispositivo
local interfaceSize
local textSize
local buttonSize
local elementScale
if isMobile then
    interfaceSize = UDim2.fromOffset(150, 100)
    textSize = 8 -- Fonte ainda menor para mobile
    buttonSize = UDim2.new(0, 15, 0, 15) -- Botões ainda menores para mobile
    elementScale = 0.33 -- Escala de 1/3 para elementos móveis
else
    interfaceSize = UDim2.fromOffset(450, 300)
    textSize = 14
    buttonSize = UDim2.new(0, 30, 0, 30)
    elementScale = 1
end

-- Carrega a Orion Library
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

-- Função para adicionar o botão de minimizar
local function adicionarBotaoMinimizar()
    spawn(function()
        wait(0.5)
        
        local mercuryGui = game:GetService("CoreGui"):WaitForChild("Mercury", 10)
        if not mercuryGui then return end
        
        local main = mercuryGui:WaitForChild("Main", 10)
        if not main then return end
        
        local topBar = main:WaitForChild("TopBar", 10)
        if not topBar then return end
        
        -- Ajusta o tamanho da fonte e escala de todos os elementos na GUI
        local function ajustarElementos(parent)
            for _, obj in pairs(parent:GetDescendants()) do
                if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
                    obj.TextSize = textSize
                    
                    -- Ajusta o tamanho do elemento se tiver Size definido
                    if obj.Size.X.Scale > 0 or obj.Size.Y.Scale > 0 then
                        local newSize = UDim2.new(
                            obj.Size.X.Scale * elementScale,
                            obj.Size.X.Offset * elementScale,
                            obj.Size.Y.Scale * elementScale,
                            obj.Size.Y.Offset * elementScale
                        )
                        obj.Size = newSize
                    end
                end
                
                -- Ajusta posição para elementos que usam posicionamento absoluto
                if obj:IsA("GuiObject") and (obj.Position.X.Scale > 0 or obj.Position.Y.Scale > 0) then
                    local newPosition = UDim2.new(
                        obj.Position.X.Scale,
                        obj.Position.X.Offset * elementScale,
                        obj.Position.Y.Scale,
                        obj.Position.Y.Offset * elementScale
                    )
                    obj.Position = newPosition
                end
            end
        end
        
        -- Remove o botão anterior se existir
        local existingBtn = topBar:FindFirstChild("MinimizeButton")
        if existingBtn then
            existingBtn:Destroy()
        end
        
        -- Cria o novo botão de minimizar
        local minimizeBtn = Instance.new("TextButton")
        minimizeBtn.Name = "MinimizeButton"
        minimizeBtn.Text = "-"
        minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        minimizeBtn.BorderSizePixel = 0
        minimizeBtn.Size = buttonSize
        minimizeBtn.Position = UDim2.new(1, isMobile and -40 or -60, 0, 0)
        minimizeBtn.Font = Enum.Font.SourceSansBold
        minimizeBtn.TextSize = textSize
        minimizeBtn.ZIndex = 10
        minimizeBtn.Parent = topBar
        
        -- Variável para controlar estado minimizado
        local minimized = false
        local originalSize = main.Size
        
        -- Função de minimizar/maximizar
        minimizeBtn.MouseButton1Click:Connect(function()
            minimized = not minimized
            if minimized then
                main.Size = UDim2.new(0, main.Size.X.Offset, 0, isMobile and 15 or 30)
                for _, child in pairs(main:GetChildren()) do
                    if child.Name ~= "TopBar" then
                        child.Visible = false
                    end
                end
            else
                main.Size = originalSize
                for _, child in pairs(main:GetChildren()) do
                    child.Visible = true
                end
            end
        end)
        
        -- Efeitos visuais do botão
        minimizeBtn.MouseEnter:Connect(function()
            minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        end)
        
        minimizeBtn.MouseLeave:Connect(function()
            minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        end)
        
        -- Aplica os ajustes após um pequeno delay
        wait(0.1)
        ajustarElementos(mercuryGui)
    end)
end

-- Cria a janela principal com configurações específicas para mobile
local GUI = OrionLib:MakeWindow({
    Name = "FRITISCRIPTS",
    Size = interfaceSize,
    Theme = OrionLib.Themes.Dark,
    Link = "https://github.com/shlexware/Orion"
})

-- Função para ajustar elementos da GUI após a criação
local function ajustarElementosGUI()
    spawn(function()
        wait(1)
        
        local mercuryGui = game:GetService("CoreGui"):WaitForChild("Mercury", 10)
        if not mercuryGui then return end
        
        -- Função recursiva para ajustar todos os elementos
        local function ajustarTodosElementos(parent)
            for _, obj in pairs(parent:GetDescendants()) do
                if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
                    obj.TextSize = textSize
                    
                    -- Ajusta tamanho de botões e elementos
                    if obj:IsA("GuiObject") then
                        if obj.Size.Y.Offset > 15 then
                            local newSize = UDim2.new(
                                obj.Size.X.Scale * elementScale,
                                obj.Size.X.Offset * elementScale,
                                obj.Size.Y.Scale * elementScale,
                                obj.Size.Y.Offset * elementScale
                            )
                            obj.Size = newSize
                        end
                    end
                end
                
                -- Ajusta padding e outros elementos de UI
                if obj:IsA("UIPadding") then
                    obj.PaddingTop = UDim.new(0, isMobile and 2 or 5)
                    obj.PaddingBottom = UDim.new(0, isMobile and 2 or 5)
                    obj.PaddingLeft = UDim.new(0, isMobile and 2 or 5)
                    obj.PaddingRight = UDim.new(0, isMobile and 2 or 5)
                end
            end
        end
        
        ajustarTodosElementos(mercuryGui)
    end)
end

-- Chama as funções de ajuste
adicionarBotaoMinimizar()
ajustarElementosGUI()

-- Cria a aba principal
local MainTab = GUI:MakeTab({
    Name = "Principal",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Seção de Movimentação
local MovementSection = MainTab:AddSection({
    Name = "Movimentação"
})

-- Toggle para Noclip
MovementSection:AddToggle({
    Name = "Noclip",
    Default = false,
    Callback = function(Value)
        noclipEnabled = Value
    end    
})

-- Toggle para Super Jump
MovementSection:AddToggle({
    Name = "Super Jump",
    Default = false,
    Callback = function(Value)
        superJumpEnabled = Value
    end    
})

-- Toggle para ShiftLock
MovementSection:AddToggle({
    Name = "SHIFTLOCK",
    Default = false,
    Callback = function(Value)
        shiftlockEnabled = Value
        if Value then
            game:GetService("Players").LocalPlayer.DevEnableMouseLock = true
        else
            game:GetService("Players").LocalPlayer.DevEnableMouseLock = false
        end
    end    
})

-- Seção de Jogador
local PlayerSection = MainTab:AddSection({
    Name = "Jogador"
})

-- Toggle para ESP
PlayerSection:AddToggle({
    Name = "ESP",
    Default = false,
    Callback = function(Value)
        espEnabled = Value
        if not Value then
            -- Remove ESP existente
            for _, part in pairs(espParts) do
                if part and part.Parent then
                    part:Destroy()
                end
            end
            espParts = {}
        end
    end    
})

-- Toggle para Roubar (Steal)
PlayerSection:AddToggle({
    Name = "Roubar (Steal)",
    Default = false,
    Callback = function(Value)
        roubarEnabled = Value
        if not Value then
            if roubarPlataforma and roubarPlataforma.Parent then
                roubarPlataforma:Destroy()
                roubarPlataforma = nil
            end
            voandoRoubo = false
        end
    end    
})

-- Botão para Steal2
PlayerSection:AddButton({
    Name = "Steal2",
    Callback = function()
        -- Implementação do Steal2 aqui
        local nearestPlayer = nil
        local shortestDistance = math.huge
        
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (p.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlayer = p
                end
            end
        end
        
        if nearestPlayer then
            player.Character.HumanoidRootPart.CFrame = nearestPlayer.Character.HumanoidRootPart.CFrame
        end
    end    
})

-- Botão para Go
PlayerSection:AddButton({
    Name = "Go",
    Callback = function()
        -- Implementação do Go aqui
        local nearestPlayer = nil
        local shortestDistance = math.huge
        
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (p.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlayer = p
                end
            end
        end
        
        if nearestPlayer then
            local targetPos = nearestPlayer.Character.HumanoidRootPart.Position
            local direction = (targetPos - player.Character.HumanoidRootPart.Position).Unit
            local distance = (targetPos - player.Character.HumanoidRootPart.Position).Magnitude
            local speed = 2.05 -- Velocidade ajustada
            
            for i = 1, distance, speed do
                if not running then break end
                player.Character.HumanoidRootPart.CFrame = CFrame.new(
                    player.Character.HumanoidRootPart.Position + direction * speed
                )
                wait()
            end
        end
    end    
})

-- Teclado
uis.InputBegan:Connect(function(input, gameProcessed)
    if not running or gameProcessed then return end

    if input.KeyCode == Enum.KeyCode.Space and superJumpEnabled then
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then 
            hrp.Velocity = Vector3.new(0, 120, 0) 
        end
    end
end)

-- Função para encontrar o jogador mais próximo
local function encontrarJogadorProximo()
    local jogadorMaisProximo = nil
    local menorDistancia = math.huge
    
    for _, p in ipairs(game.Players:GetPlayers()) do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local distancia = (p.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distancia < menorDistancia then
                menorDistancia = distancia
                jogadorMaisProximo = p
            end
        end
    end
    
    return jogadorMaisProximo
end

-- Loop de execução
runService.RenderStepped:Connect(function()
    if not running then return end

    if noclipEnabled and player.Character then
        for _, part in ipairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end

    if espEnabled then
        for _, p in ipairs(game.Players:GetPlayers()) do
            if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and not espParts[p.Name] then
                local box = Instance.new("BoxHandleAdornment")
                box.Size = Vector3.new(6, 6, 6)
                box.Color3 = Color3.new(1, 0, 0)
                box.AlwaysOnTop = true
                box.ZIndex = 10
                box.Adornee = p.Character.HumanoidRootPart
                box.Transparency = 0.3
                box.Name = "ESPBox"
                box.Parent = p.Character.HumanoidRootPart
                espParts[p.Name] = box
            end
        end
    end

    if voandoRoubo and roubarPlataforma and player.Character then
        local hrp = player.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local targetPosition = roubarPlataforma.Position + Vector3.new(0, 3, 0)
            local dir = (targetPosition - hrp.Position)
            
            if dir.Magnitude < 3 then
                -- Chegou na plataforma
                hrp.Velocity = Vector3.zero
                voandoRoubo = false
            else
                -- Plana suavemente em direção à plataforma
                local velocidadeHorizontal = dir.Unit * 20
                local velocidadeVertical = Vector3.new(0, 0, 0)
                hrp.Velocity = (velocidadeHorizontal + velocidadeVertical) * 2.05
            end
        end
    end

    if goEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local alvoProximo = encontrarJogadorProximo()
        if alvoProximo then
            local hrp = player.Character.HumanoidRootPart
            local targetPosition = alvoProximo.Character.HumanoidRootPart.Position -- Remove o offset de altura para ficar na mesma altura
            local dir = (targetPosition - hrp.Position)
            
            -- Plana/voa em direção ao alvo
            local velocidadeHorizontal = dir.Unit * 25 -- Velocidade horizontal um pouco maior
            local velocidadeVertical = Vector3.new(0, 0, 0)
            hrp.Velocity = (velocidadeHorizontal + velocidadeVertical) * 2.05
        end
    end
end)

-- Função para destruir a UI quando necessário
local function Destroy()
    GUI:Destroy()
end 
